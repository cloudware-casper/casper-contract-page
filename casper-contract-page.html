<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-button/paper-button.html">

<dom-module id="casper-contract-page">
  <template>
    <style>

      :host {
        display: flex;
        flex-direction: column;
        padding: 10px;
        width: 70%;
        max-width: 960px;
        box-sizing: border-box;
        word-break: break-all;
      }

      .content {
        overflow: auto;
        padding: 10px;
        background-color: white;
      }


      .container-text, .title {
        padding: 20px;
      }

      .container-text {
        padding-bottom: 100px;
      }

      .content .hero img {
        width: 100%;
        display: inline-block;
      }

      ::slotted(hr) {
        display: none;
      }

      ::slotted(b) {
        color: var(--primary-color);
        font-size: 20px;
        font-weight: normal;
      }

      ::slotted(a){
        color: var(--primary-color);;
        text-transform: none;
      }

      ::slotted(a:hover){
        background-color: var(--primary-color);
        color: white;
      }

      paper-button{
        width: 100%;
        text-align: center;
        background-color: var(--primary-color);
        color: white;
        margin: 0px;
        /* margin-top: 20px;
        margin-bottom: 20px;
        margin: 120px; */
        /* word-break: break-all; */
      }

      paper-button[disabled] {
        background: #eaeaea;
        color: #a8a8a8;
        cursor: auto;
        pointer-events: none;
      }

      .button-container {
        padding: 10px 20px 20px 20px;
        background: white;
        position: fixed;
        bottom: 0;
        width: 882px;
        border-top: 1px #eaeaea solid;
        /* left: 0; */
        /* width: 70%; */
        /* max-width: 960px; */
        /* width: 960px; */
      }

      .button-container .instructions {
        text-align: center;
        display: inherit;
        margin-bottom: 10px;
        color: gray;
      }

      .button-container paper-button {
        width: 100%;
      }

      .title {
        font-size: 40px;
        color: var(--primary-color);
        font-family: 'Titan One', cursive;
      }


      @media only screen
      and (min-device-width : 320px)
      and (max-device-width : 1024px)
      and (-webkit-min-device-pixel-ratio: 1)  {

        :host {
          width: 100%;
          /* background: green; */
        }


      }
    </style>

    <div class="content">

      <template is="dom-if" if="[[image]]" restamp="true">
        <div class="hero">
          <img src="[[image]]" alt="hero image">
        </div>
      </template>

      <template is="dom-if" if="[[title]]" restamp="true">
        <div class="title">
          [[title]]
        </div>
      </template>
      <div class="container-text">
        <slot></slot>
      </div>
      <div class="button-container">
        <small class='instructions'>Obrigatório ler as condições antes de aceitar.</small>
        <paper-button id="submitButton" disabled on-tap="_customerAgreement">Concordo</paper-button>
      </div>
    </div>

  </template>

  <script>
    /**
     * `casper-contract-page`
     * A component to acceptance of terms and conditions
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class CasperContract extends Polymer.Element {
      static get is() { return 'casper-contract-page'; }
      static get properties() {
        return {
          xhrUrl: {
            type: String,
            value: '/jobs'
          },
          jwtParam: {
            type: String,
            value: 'jwt'
          },
          title: {
            type: Object
          },
          image: {
            type: Object
          }
        };
      }

      static getParams (url) {
         var regex = /[?&]([^=#]+)=([^&#]*)/g,
             params = {},
             match;
         while(match = regex.exec(url)) {
             params[match[1]] = match[2];
         }
         return params;
      }

      ready () {
        super.ready();
        this._params = CasperContract.getParams(window.location.href);
        window.onscroll = function(ev) {
           if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
              this.$.submitButton.disabled = false;
           }
        }.bind(this);

        this._adjustButton();

        window.onresize = function(){
          this._adjustButton();
        }.bind(this);

      }

      _adjustButton () {
        var text   = this.shadowRoot.querySelector('.container-text');
        var button = this.shadowRoot.querySelector('.button-container');
        button.style.width = text.getBoundingClientRect().width - 40 + 'px';
      }

      _customerAgreement (event) {
        var xhr = new XMLHttpRequest();
    		xhr.open("POST", this.xhrUrl, true);
    		xhr.setRequestHeader("Content-type", "application/text");
    		xhr.setRequestHeader("Accept",       "application/json");
    		xhr.timeout = 10000;

        xhr.send(this._params[this.jwtParam]);
      }
    }

    window.customElements.define(CasperContract.is, CasperContract);
  </script>
</dom-module>
